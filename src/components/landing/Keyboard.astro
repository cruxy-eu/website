---
interface Props {
  keys: Key[];
  tabIndexStart: number;
}
interface Key {
  key: string;
  href: string;
}
const { keys, tabIndexStart }: Props = Astro.props;

const total = keys.length;

const reversedKeys = [...keys].reverse();
---

<div
  class="keyboard flex flex-row-reverse flex-wrap items-center justify-center"
>
  {
    reversedKeys.map((key, i) => (
      <div class="key-container" style={`z-index: ${i + 1};`}>
        <div
          class:list={[
            "key bg-muted-background -m-0.5 basis-[30%] grow-0 rounded-xl border-t-2 border-r-2 border-b-12 border-l-12 border-t-neutral-400 border-r-neutral-400 border-b-neutral-800 border-l-neutral-600 p-4 text-center font-mono text-4xl transition-all hover:cursor-pointer",
            "skew-x-10 transform",
          ]}
        >
          <a
            href={key.href}
            class="flex items-center justify-center gap-2"
            tabindex={tabIndexStart + total - i}
          >
            {key.key}
            <span class="text-2xl opacity-60">â†’</span>
          </a>
        </div>
      </div>
    ))
  }
</div>
<style>
  .key {
    box-shadow: 0px 0px 4px 2px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease-in-out;
  }

  .key:hover {
    transform: translate(-5px, 5px) skewX(10deg);
  }

  @media (prefers-reduced-motion: no-preference) {
    .key-container {
      opacity: 0;
      transform: translate(20px, -20px) skewX(10deg);
    }

    .key-container.animate-in {
      opacity: 1;
      transform: translate(0, 0) skewX(10deg);
      transition:
        opacity 0.5s ease-out,
        transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
  }

  @prefers-reduced-motion (reduce) {
    .key-container,
    .key-container.animate-in,
    .key:hover {
      opacity: 1 !important;
      transition: none !important;
      transform: none !important;
    }
  }
</style>
<script>
  const observerOptions = {
    threshold: 0.1,
    rootMargin: "0px 0px -50px 0px",
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        // Animate children with stagger
        const keys = entry.target.querySelectorAll(".key-container");
        const reverseKeys = Array.from(keys).reverse();
        reverseKeys.forEach((key, index) => {
          setTimeout(() => {
            key.classList.add("animate-in");
          }, index * 100); // 100ms delay between each key
        });

        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  const observe = () => {
    document.querySelectorAll(".keyboard").forEach((el) => {
      observer.observe(el);
    });
  };

  // Observe the container
  document.addEventListener("astro:after-swap", () => {
      observe();
  });
  observe();
</script>
